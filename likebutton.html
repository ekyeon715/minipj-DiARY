<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Like Button Example</title>

    <style>
        .fa-heart {
            width: 20px;
            height: 20px;
            cursor: pointer;
            transition: fill 0.3s ease;
        }

        .fa-heart.filled {
            fill: red;
        }
        
        button {
            border: 0;
            background-color: #ffffff;
            width: 20px;
            height: 20px;
        }
<<<<<<< HEAD

        .like {

            display: flex;
            flex-direction: column;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="like">
=======
    </style>
</head>
<body>
>>>>>>> 117451cc7eeeacb621fd1919c2afbc9997de7c2b
    <button id="likeButton">
        <svg id="toggleImg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="fa-heart">
            <path d="M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20c0 0-.1-.1-.1-.1c0 0 0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"/>
        </svg>
    </button>
<<<<<<< HEAD

    <div><span id="likeCount">0</span></div>
</div>
=======
    <div>Likes: <span id="likeCount">0</span></div>
>>>>>>> 117451cc7eeeacb621fd1919c2afbc9997de7c2b

    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, setDoc, updateDoc, increment, getDoc, collection, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Firebase 구성 정보 설정
        const firebaseConfig = {
            apiKey: "AIzaSyCABiHiGzxGELpkUPOgFO_sgwI2SqUblLw",
            authDomain: "diary-be831.firebaseapp.com",
            projectId: "diary-be831",
            storageBucket: "diary-be831.appspot.com",
            messagingSenderId: "1030858653688",
            appId: "1:1030858653688:web:e25e3a5d7965126b84600d"
        };

        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const likeButton = document.getElementById("likeButton");
       

        async function toggleHeart() {
<<<<<<< HEAD
            const userId = "someUniqueUserId" // 로그인 없이 유니크한 사용자 ID 생성
=======
            const userId = crypto.randomUUID(); // 로그인 없이 유니크한 사용자 ID 생성
>>>>>>> 117451cc7eeeacb621fd1919c2afbc9997de7c2b
            const postId = "postId"; // 예제 포스트 ID
            const postRef = doc(db, "testPosts", postId);
            const userLikeRef = doc(collection(postRef, "likedUsers"), userId);
            console.log(postRef)

            const docSnap = await getDoc(userLikeRef);
            let likeCount = 0;

            if (docSnap.exists()) {
                await deleteDoc(userLikeRef);
                await updateDoc(postRef, { likeCount: increment(-1) });
                document.getElementById("toggleImg").classList.remove("filled");
            } else {
                await setDoc(userLikeRef, {});
                await updateDoc(postRef, { likeCount: increment(1) });
                document.getElementById("toggleImg").classList.add("filled");
            }

            const postSnap = await getDoc(postRef);
            if (postSnap.exists()) {
                likeCount = postSnap.data().likeCount;
                
            }

            document.getElementById("likeCount").innerText = likeCount;
        }

        likeButton.addEventListener("click",toggleHeart)

        document.addEventListener("DOMContentLoaded", async () => {
            const postId = "examplePostId"; // 예제 포스트 ID
            const postRef = doc(db, "posts", postId);
            const postSnap = await getDoc(postRef);

            if (postSnap.exists()) {
                document.getElementById("likeCount").innerText = postSnap.data().likeCount || 0;
            }
        });
    </script>
</body>
</html>
